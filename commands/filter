#!/usr/bin/python

import argparse

from functools import partial

from fttypes import T_BOOL
from command import panic, ftformat, input_values
from functions import commands

parser = argparse.ArgumentParser(description='filter')
parser.add_argument('command', help='todo')
parser.add_argument('args', help='todo', nargs='*')

args = parser.parse_args()

try:
    command = commands[args.command]
except KeyError:
    panic("Command not found: '{}'".format(args.command))

# Partially apply the command

if len(args.args) > 0:
    command = partial(command, *args.args)

for value in input_values():
    result = command(value)

    if result.fttype == T_BOOL:
        if result.value:
            out = ftformat(value)
            if out:
                print(out)
    else:
        panic("The filter command needs to return a boolean")
